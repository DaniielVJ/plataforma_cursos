<!--La view manda a este template despues de haber ejecutado toda su logica las secciones asociadas
al curso que se envia por parametro en la url y ademas tambien se carga el curso-->

{% extends 'base.html' %}
{% block title %}Mis Cursos{% endblock title %}
{% load static %}


{% block custom_styles %}
    <link rel="stylesheet" href="{% static 'css/styles.css' %}">
    <link rel="stylesheet" href="{% static 'css/instructor.css' %}">
{% endblock custom_styles %}
    



{% block content %}
    <div class="layout">
        {% include 'includes/sidebar_instructor.html' %}
        <div class="main-content">
            {% include 'includes/header_instructor.html' %}
            
            <main>
                <h2 class="form-title">Secciones del curso "{{course.title}}"</h2>
                
                <div class="add-new-course">
                    <a href="{% url 'instructor:create_section' course_slug=course.slug%}">AÃ±adir Seccion</a>
                </div>

                <ul class="drag-list" id="section_list">
                    
                    {% for section in sections %}
                        <li class="drag-item" data-id="{{section.id}}">
                            <strong>{{section.title}}</strong>
                            <div class="actions">
                                <a href="{% url 'instructor:content_list' course_slug=course.slug section_id=section.pk %}"><i class="fa-solid fa-eye"></i>&#32;Ver contenidos</a>
                                <a href="{% url 'instructor:update_section' course_slug=course.slug pk=section.pk%}"><i class="fa-solid fa-pen-to-square"></i>&#32;Editar la Seccion</a>
                                <a href="{% url 'instructor:delete_section' course_slug=course.slug pk=section.pk%}"><i class="fa-solid fa-trash"></i>&#32;Eliminar la Seccion</a>
                            </div>
                        </li>
                    {% empty %}
                        <li>No hay secciones disponibles.</li>
                    {% endfor %}
                        
                </ul>
            </main>

        </div>
    </div>
{% endblock content %}
    



{% block scripts %}
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.15.6/Sortable.min.js"></script>
    <script>
        const contenedorElementos = document.getElementById("section_list");
        const sortable = new Sortable(contenedorElementos, {
            "animation": 150,
            "onEnd": function(){
                console.log("Elementos movido dentro del contenedorx")
                let orden = Array.from(contenedorElementos.children).map(elemento => elemento.dataset.id)
                
                fetch("{% url 'instructor:order_section' %}", {
                    method: "POST",
                    headers: {
                        // Este header le dice al server que tipo de datos le estamos transmitiendo
                        "Content-Type": "application/json   ",
                        // Este header le dice al servidor que el valor que se encuentra aqui es un token csrf
                        // e igualmente es el header donde buscara el server en una peticion http si solicita un csrf token
                        "X-CSRFToken": "{{csrf_token}}" ,
                    },
                    body: JSON.stringify({'orden': orden})
                }).then(response => {
                    if(!response.ok){
                        console.warn("El servidor no pudo resolver", response.status)
                    }else {
                        console.log("ok")
                    }
                }).catch(error => console.error(error))
            }
        })
    </script>
{% endblock scripts %}
    